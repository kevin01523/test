<h1 class="gh-header-title instapaper_title">服务端常见问题排查</h1>
        <div class="gh-header-meta">
          破娃酱 edited this page <relative-time datetime="2017-02-23T08:47:31Z">Feb 23, 2017</relative-time>
          &middot;
          <a href="/breakwa11/shadowsocks-rss/wiki/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/_history" class="history">
            2 revisions
          </a>
        </div>
    </div>
  </div>
  <div id="wiki-content" class="wiki-content">
    <div class="has-rightbar">

    <div id="wiki-rightbar" class="wiki-rightbar">
      <div class="wiki-pages-box readability-sidebar boxed-group flush js-wiki-pages-box " role="navigation">
        
<h3 class="js-wiki-toggle-collapse wiki-auxiliary-content">
  <svg aria-hidden="true" class="octicon octicon-triangle-down caret-expanded" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M0 5l6 6 6-6z"/></svg>
  <svg aria-hidden="true" class="octicon octicon-triangle-right caret-collapsed" height="16" version="1.1" viewBox="0 0 6 16" width="6"><path fill-rule="evenodd" d="M0 14l6-6-6-6z"/></svg>
  Pages <span class="Counter">21</span>
</h3>
<div class="boxed-group-inner wiki-auxiliary-content wiki-auxiliary-content-no-bg">
    <div class="filter-bar">
      <input type="text" id="wiki-pages-filter" class="form-control input-sm input-block js-filterable-field" placeholder="Find a Page…" aria-label="Find a Page…" tabindex="2">
    </div>

  <ul class="wiki-pages" data-filterable-for="wiki-pages-filter" data-filterable-type="substring">
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki" class="wiki-page-link">Home</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/C%23-API" class="wiki-page-link">C# API</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/C%23-Proxy-Rule" class="wiki-page-link">C# Proxy Rule</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/config.json" class="wiki-page-link">config.json</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Custom-DNS-(Multi-language)" class="wiki-page-link">Custom DNS (Multi language)</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/FAQ-(Multi-language)" class="wiki-page-link">FAQ (Multi language)</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/libsodium" class="wiki-page-link">libsodium</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Mysql-SSL-%E9%85%8D%E7%BD%AE" class="wiki-page-link">Mysql SSL 配置</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/obfs" class="wiki-page-link">obfs</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Python-client-setup-(Mult-language)" class="wiki-page-link">Python client setup (Mult language)</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Server-Setup" class="wiki-page-link">Server Setup</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Server-Setup-on-Windows" class="wiki-page-link">Server Setup on Windows</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Server-Setup(manyuser-with-mu-api-v2)" class="wiki-page-link">Server Setup(manyuser with mu api v2)</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Server-Setup(manyuser-with-mudbjson)" class="wiki-page-link">Server Setup(manyuser with mudbjson)</a></strong>
    </li>
    <li>
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Server-Setup(manyuser-with-mysql)" class="wiki-page-link">Server Setup(manyuser with mysql)</a></strong>
    </li>
    <li class="wiki-more-pages">
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/SSR-QRcode-scheme" class="wiki-page-link">SSR QRcode scheme</a></strong>
    </li>
    <li class="wiki-more-pages">
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Subscribe-%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%A2%E9%98%85%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3" class="wiki-page-link">Subscribe 服务器订阅接口文档</a></strong>
    </li>
    <li class="wiki-more-pages">
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/System-startup-script" class="wiki-page-link">System startup script</a></strong>
    </li>
    <li class="wiki-more-pages">
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/ulimit" class="wiki-page-link">ulimit</a></strong>
    </li>
    <li class="wiki-more-pages">
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/Windows-Internet-Options" class="wiki-page-link">Windows Internet Options</a></strong>
    </li>
    <li class="wiki-more-pages">
      <strong><a href="/breakwa11/shadowsocks-rss/wiki/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" class="wiki-page-link">服务端常见问题排查</a></strong>
    </li>
    <li class="wiki-more-pages-link">
      <a href="#" class="js-wiki-more-pages-link">
        Show 6 more pages…
      </a>
    </li>
  </ul>
</div>

      </div>


      <div class="clone-url">
        <h5>Clone this wiki locally</h5>
        <div class="input-group js-zeroclipboard-container">
          <input type="text" class="form-control input-sm text-small text-gray input-monospace js-url-field js-zeroclipboard-target" aria-label="Clone URL for this wiki"
                 value="https://github.com/breakwa11/shadowsocks-rss.wiki.git" readonly="readonly">
          <span class="input-group-button">
            <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><svg aria-hidden="true" class="octicon octicon-clippy" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"/></svg></button>
          </span>
        </div>


      </div>
    </div>

    <div id="wiki-body" class="wiki-body gollum-markdown-content instapaper_body">
        <div class="markdown-body">
          <p>如果遇到问题，可按以下次序排查：</p>
<ol>
<li>检查服务端与客户端配置是否一致</li>
<li>防火墙端口有没有打开</li>
<li>服务端对应端口有没有打开（查log）</li>
<li>服务器的UTC时间是否和客户端误差超过一天</li>
<li>查看服务端log，检测对应端口开启的配置是否与预期相同</li>
<li>检查服务端配置，protocol及obfs两字段绝对不可以留空（即设置为""）</li>
<li>服务端是否开启了两个导致占用相同端口（通过 <code>ps -ef|grep python</code> 查找python进程）</li>
<li>检查是否有其它进程占用相同端口，如nginx/apache占了80/443，同时你开了这两端口</li>
<li>如果A客户端连得上，B客户端连不上，至少证明服务端正常，要确认服务端此端口允许的客户端数目不小于3个，然后确保是否在同一网络环境及同一配置，如果是，可能是客户端的问题，否则可能是网络问题，需要更多信息分析</li>
<li>如果服务端某端口允许的客户端数目只有一个，那么你客户端重新启动时，需要等待3分钟再连接此端口，否则会认为超出客户端最大数量</li>
<li>
<code>create encryptor fail at port xxx</code>此log表示你使用了一个不支持的加密，例如你没有安装libsodium然后使用chacha20</li>
<li>
<code>obfs plugin xxxx not supported</code>此log表示你使用了一个不支持的协议或混淆，例如<code>auth_aes128_md5_compatible</code>，此协议不支持兼容</li>
<li>
<code>found an error in config.json: xxx</code>此log表示你的配置文件格式错误，请检查此log所写的行和列位置上的内容</li>
<li>
<code>[Errno 98] Address already in use</code>此log表示你端口被占用，请看第7条和第8条</li>
<li>
<code>wrong timestamp, time_dif xxx</code>或<code>tls_auth wrong time</code>表示UTC时间误差过大，参见第4条</li>
<li>
<code>unsupported addrtype 69, maybe wrong password or encryption method</code>SSR特有的错误信息（addrtype 69），说明使用的是SSR配置，但客户端配置不正确，或不是SSR客户端的连接请求，均会报这个错误，更多信息需要参考此错误的上下文，如果连接IP不是你的，那么可无视</li>
<li>
<code>tls_auth wrong sessionid_len</code>这个错误和你无关，通常是普通浏览器或扫描器或主动探测器等发出的非SSR错误请求</li>
<li>
<code>tls_auth wrong sha1</code>很可能就是密码错误</li>
<li>
<code>replay attack detect</code>或<code>deprecated id, someone replay attack</code>表示你中奖了，有人在尝试重放攻击</li>
<li>如果服务器运行一段时间后最后输出结果是killed（screen方式运行可以看到），那么检查swap是不是为0，建议设置swap为1024M以上</li>
<li>如果服务器运行一段时间后不稳定，有时能连接上有时不能，那么检查log里，服务端刚运行时的输出，应该会包含一行类似<code>current process RLIMIT_NOFILE resource: soft 1024 hard 4096</code>，如果你看到这个soft和hard的数值不超过10000，那么你应该修改此值，<a href="https://github.com/breakwa11/shadowsocks-rss/wiki/ulimit">参见这里</a>
</li>
</ol>
